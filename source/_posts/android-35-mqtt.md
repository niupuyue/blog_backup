---
title: 重拾android路(三十五) MQTT
date: 2019-12-24 21:35:51
tags:
  - android
  - MQTT
---

# 关于MQTT

## 介绍
MQTT，消息队列遥测传输，是IBM开发的一个即时通信协议。它是一种发布/订阅，极其简单和轻量级的消息传递协议，专门为受限设备和低带宽，高延迟或不可靠的网络而设计。它的设计思想是轻巧，开放，简单，规范，易于实现。这些特点使得他对很多场景来说都是很好的选择。特别是一些受限环境如机器与机器的通信(M2M)以及物联网环境，相对于XMPP，MQTT更加轻量级，并且占用的宽带低。

## 特点
1. 使用发布/订阅消息模式。提供一对多的消息发布，解除应用程序耦合
2. 对敷在内容屏蔽的消息传输模式
3. 使用TCP/IP提供网络连接
4. 有三种消息发布服务质量
    - qos为0:"至多1次"，消息发布完全依赖底层TCP/IP网络。会发生消息丢失或重复，这一级别可用于如下情况：环境传感器数据，丢失一次几路无所谓，因为不久之后还有第二次发送
    - qos为1:"至少1次"，确保消息到达，但消息重复可能会发生，这一级别可用于如下情况：你需要获取每条消息，并且消息重复发送对我们来说无影响
    - qos为2::"只有1次"，确保消息到达一次，这一级别可用于如下情况，在计费系统中，消息重复或丢失导致不正确的结果
5. 小型传输，开销很小(固定长度的头部是2字节)。协议交换最小化，以降低网络流量。使用Last Will和Testament特性通知有关各方客户端异常中断的机制

## MQTT体系结构
如下图所示
![MQTT体系结构](/assets/android/mqtt01.png)

我们可以这样理解，我们去一个景区玩，进入景区配置一台闸机设备作为发布者(publisher),当闸机设备监控到有游客进入的时候，会发布一个带有主体(topic)的消息(例如主题为：welcome)给服务器(MQTT-Broker),当服务器收到发不过来的消息后，进行基于主题的过滤，将消息转发给鼎娱乐该主题的订阅者。而景区的大屏幕作为定于这(Subscriber),订阅的主题也是welcome,这样就能接收到服务器转发过来的消息，收到消息后在大屏幕上显示我们需要的内容

在该结构图中，闸机设备和大屏幕都是客户端，都可以进行发布和订阅。


# 参考博客
[android App必备高级功能，消息推送之MQTT](https://blog.csdn.net/qq_17250009/article/details/52774472)
[Android消息推送MQTT实战](https://www.jianshu.com/p/73436a5cf855)
[Getting started with MQTT](https://www.hivemq.com/blog/how-to-get-started-with-mqtt/)